Index: src/main/java/main/doanjava2/graphCanvas/GraphImage.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package main.doanjava2.graphCanvas;\r\n\r\nimport java.math.BigDecimal;\r\nimport java.math.MathContext;\r\nimport java.util.List;\r\n\r\nimport com.udojava.evalex.Expression;\r\n\r\nimport ch.obermuhlner.math.big.BigDecimalMath;\r\n\r\nimport javafx.scene.canvas.Canvas;\r\nimport javafx.scene.canvas.GraphicsContext;\r\nimport javafx.scene.layout.Region;\r\nimport javafx.scene.paint.Color;\r\nimport main.doanjava2.GraphData;\r\nimport main.doanjava2.MainController;\r\n\r\nclass GraphImage_Params{\r\n\tstatic double plottingSpaceOnScreen = 10;\r\n\tstatic int loopLimit = 5;\r\n\tstatic int maxRecursion = 5;\r\n\tstatic double angleThreshold = 20;//in degree\r\n}\r\npublic class GraphImage {\r\n\tSetting settingRef;\r\n\tGraphData dataRef;\r\n\tCanvas canvas;\r\n\tprivate GraphicsContext gc;\r\n\tpublic void setManagerRef(MainController ref) {\r\n\t\tmnr = ref;\r\n\t}\r\n\tMainController mnr;\r\n\tpublic GraphImage(Setting settingRef, GraphData dataRef) {\r\n\t\tthis.settingRef = settingRef;\r\n\t\tthis.dataRef = dataRef;\r\n\t\t\r\n\t\tdataRef.addListener(ob -> update());\r\n\t\tcanvas = new Canvas();\r\n\t\tgc = canvas.getGraphicsContext2D();\r\n\t}\r\n\tpublic void update() {\r\n\t\tclear();\r\n\t\tdrawGraph();\r\n\t\tcanvas.toFront();\r\n\t}\r\n\tpublic void hide() {\r\n\t\tcanvas.setVisible(true);\r\n\t}\r\n\tpublic void show() {\r\n\t\tcanvas.setVisible(false);\r\n\t}\r\n\tpublic void setZIndex(int zIndex) {\r\n\t\tcanvas.setViewOrder(zIndex);\r\n\t}\r\n\tpublic void rescaleUI(double width, double height) {\r\n\t\tRegion par = (Region) canvas.getParent();\r\n\t\tcanvas.setWidth( par.getWidth());\r\n\t\tcanvas.setHeight( par.getHeight());\r\n\t\tclear();\r\n\t\tupdate();\r\n\t}\r\n\tpublic void clear() {\r\n\t\tgc.clearRect(0, 0, canvas.getWidth(), canvas.getHeight());\r\n\t}\r\n\t\r\n\tenum PointState{\r\n\t\tInside,\r\n\t\tOutside,\r\n\t\tMinusInfinity,\r\n\t\tPlusInfinity,\r\n\t\tUndetermined\r\n\t}\r\n\tprivate class PointInfo{\r\n\t\tprivate double input, yValue;\r\n\t\tprivate double onScreenX, onScreenY;\r\n\t\tprivate PointState state;\r\n\t\tpublic PointInfo(double pointValueX, Expression expression) {\r\n\t\t\texpression.setVariable(\"x\", Double.toString(pointValueX));\r\n\t\t\ttry {\r\n\t\t\t\tsetInput(pointValueX);\r\n\t\t\t\tBigDecimal r = expression.eval();\r\n\t\t\t\tdouble pointValueY = r.doubleValue();\r\n\t\t\t\tyValue = pointValueY;\r\n\t\t\t\t\r\n\t\t\t\tonScreenX = getOnCanvasCoordinateX(pointValueX);\r\n\t\t\t\tonScreenY = getOnCanvasCoordinateY(pointValueY);\r\n\t\t\t\t\r\n\t\t\t\t//handling state\r\n\t\t\t\tif(pointValueY>settingRef.botBoundary.get()&&pointValueY<settingRef.topBoundary.get()) {\r\n\t\t\t\t\tstate = PointState.Inside;\r\n\t\t\t\t}\r\n\t\t\t\telse if(pointValueY>settingRef.topBoundary.get()*5) {\r\n\t\t\t\t\tstate = PointState.PlusInfinity;\r\n\t\t\t\t}\r\n\t\t\t\telse if(pointValueY<settingRef.botBoundary.get()*5) {\r\n\t\t\t\t\tstate = PointState.MinusInfinity;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tstate = PointState.Outside;\r\n\t\t\t\t}\t\t\r\n\t\t\t}\r\n\t\t\tcatch(Exception e) {\r\n\t\t\t\tstate = PointState.Undetermined;\r\n\t\t\t\t//System.out.println(e);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic double getOnScreenX() {\r\n\t\t\treturn onScreenX;\r\n\t\t}\r\n\t\tpublic double getOnScreenY() {\r\n\t\t\treturn onScreenY;\r\n\t\t}\r\n\t\tpublic PointState getState() {\r\n\t\t\treturn state;\r\n\t\t}\r\n\t\tpublic double getInput() {\r\n\t\t\treturn input;\r\n\t\t}\r\n\t\tpublic double getOutput() {\r\n\t\t\treturn yValue;\t\r\n\t\t}\r\n\t\tpublic void setInput(double input) {\r\n\t\t\tthis.input = input;\r\n\t\t}\r\n\t}\r\n\tprivate void drawGraph() {\r\n\t\tif(dataRef.getExpressionString().equals(\"\")) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tString replacedExpression = mnr.handleReplaceExpressions(dataRef);\r\n\t\tSystem.out.println(\"check..........:     \" +replacedExpression);\r\n\r\n\t\tdouble plottingSpace = GraphImage_Params.plottingSpaceOnScreen/canvas.getWidth() * settingRef.getBoundaryWidth();\r\n\t\tdouble currentX = settingRef.leftBoundary.get();\r\n\t\tdouble endX = settingRef.rightBoundary.get()+plottingSpace;\r\n\t\tdouble preX = currentX-plottingSpace/2;\r\n\t\t\t\r\n\t\tExpression expression = new Expression(replacedExpression);\r\n\t\texpression.addFunction(expression.new Function(\"sin\", 3) {\r\n\t\t\t@Override\r\n\t\t\tpublic BigDecimal eval(List<BigDecimal> parameters) {\r\n\t\t\t\tBigDecimal result = BigDecimalMath.sin(parameters.get(0), MathContext.DECIMAL32);\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\t\t});\t\r\n\t\texpression.addFunction(expression.new Function(\"sin\", 3) {\r\n\t\t\t@Override\r\n\t\t\tpublic BigDecimal eval(List<BigDecimal> parameters) {\r\n\t\t\t\tBigDecimal result = BigDecimalMath.cos(parameters.get(0), MathContext.DECIMAL32);\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\t\t});\t\r\n\t\texpression.addFunction(expression.new Function(\"tan\", 3) {\r\n\t\t\t@Override\r\n\t\t\tpublic BigDecimal eval(List<BigDecimal> parameters) {\r\n\t\t\t\tBigDecimal result = BigDecimalMath.tan(parameters.get(0), MathContext.DECIMAL32);\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\t\t});\r\n\t\texpression.addFunction(expression.new Function(\"log\", 3) {\r\n\t\t\t@Override\r\n\t\t\tpublic BigDecimal eval(List<BigDecimal> parameters) {\r\n\t\t\t\tif(parameters.get(0).doubleValue()<1e-10) {\r\n\t\t\t\t\treturn new BigDecimal(-1e+9);\r\n\t\t\t\t}\r\n\t\t\t\tBigDecimal result = BigDecimalMath.log(parameters.get(0), MathContext.DECIMAL32);\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\t\t});\r\n\t\t//System.out.println(\"Result: \" + result);  \r\n\t\r\n\t\tPointInfo prePointInfo = new PointInfo(preX,expression);\r\n\t\tPointInfo curPointInfo = prePointInfo;\r\n\t\t\r\n\t\twhile(currentX<endX) {\t\t\t\t\r\n\t\t\tgc.setLineWidth(dataRef.getLineWidth());\r\n\t\t\tgc.setGlobalAlpha(dataRef.getOpacity());\r\n\t\t\tgc.setStroke(dataRef.getGraphColor());\r\n\t\t\t\r\n\t\t\tcurPointInfo = new PointInfo(currentX,expression);\t\r\n\t\t\tcurrentX+=plottingSpace;\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t//check state\r\n\t\t\tPointState preState = prePointInfo.getState();\r\n\t\t\tPointState curState = curPointInfo.getState();\r\n\t\t\t//System.out.println(curState.toString());\r\n\t\t\tif(preState.equals(PointState.Inside)&&curState.equals(PointState.Inside)\r\n\t\t\t || (preState.equals(PointState.Outside)&&curState.equals(PointState.Inside))\r\n\t\t\t || (preState.equals(PointState.Inside)&&curState.equals(PointState.Outside))) \r\n\t\t\t{\r\n\t\t\t\tprePointInfo = inspectFurther(prePointInfo, curPointInfo, 0, expression);\r\n\t\t\t\t/*\r\n\t\t\t\tgc.strokeLine(prePointInfo.getOnScreenX(), prePointInfo.getOnScreenY(),\r\n\t\t\t\t\t\t\t  curPointInfo.getOnScreenX(),curPointInfo.getOnScreenY());\r\n\t\t\t\t*/\r\n\t\t\t\t/*\r\n\t\t\t\tgc.setStroke(Color.BLUE);\r\n\t\t\t\tgc.strokeLine(prePointInfo.getOnScreenX(), 0,\r\n\t\t\t\t\t\tprePointInfo.getOnScreenX(),canvas.getHeight());\r\n\t\t\t\tgc.setStroke(Color.GREEN);\r\n\t\t\t\tgc.strokeLine(curPointInfo.getOnScreenX(), 0,\r\n\t\t\t\t\t\tcurPointInfo.getOnScreenX(),canvas.getHeight());\r\n\t\t\t\t*/\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tgc.setStroke(Color.ORANGE);\r\n\t\t\tif(preState.equals(PointState.Undetermined)&&curState.equals(PointState.Inside)) {\r\n\t\t\t\tapproximateUndeterminedPoint(curPointInfo, prePointInfo, expression);\r\n\t\t\t}\r\n\t\t\tif(preState.equals(PointState.Inside)&&curState.equals(PointState.Undetermined)) {\r\n\t\t\t\tapproximateUndeterminedPoint(prePointInfo, curPointInfo, expression);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif(preState.equals(PointState.MinusInfinity)&&curState.equals(PointState.Inside)) {\r\n\t\t\t\tgc.strokeLine(curPointInfo.getOnScreenX(), curPointInfo.getOnScreenY(),\r\n\t\t\t\t\t\t\t  curPointInfo.getOnScreenX(),canvas.getHeight());\r\n\t\t\t}\r\n\t\t\tif(preState.equals(PointState.Inside)&&curState.equals(PointState.MinusInfinity)) {\r\n\t\t\t\tgc.strokeLine(prePointInfo.getOnScreenX(), prePointInfo.getOnScreenY(),\r\n\t\t\t\t\t\t\t  prePointInfo.getOnScreenX(),canvas.getHeight());\r\n\t\t\t}\r\n\t\t\tif(preState.equals(PointState.PlusInfinity)&&curState.equals(PointState.Inside)) {\r\n\t\t\t\tgc.strokeLine(curPointInfo.getOnScreenX(), curPointInfo.getOnScreenY(),\r\n\t\t\t\t\t\t\t  curPointInfo.getOnScreenX(),0);\r\n\t\t\t}\r\n\t\t\tif(preState.equals(PointState.Inside)&&curState.equals(PointState.PlusInfinity)) {\r\n\t\t\t\tgc.strokeLine(prePointInfo.getOnScreenX(), prePointInfo.getOnScreenY(),\r\n\t\t\t\t\t\t\t  prePointInfo.getOnScreenX(),0);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tprePointInfo = curPointInfo;\t\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate PointInfo inspectFurther(PointInfo left, PointInfo right, int currentRecursion, Expression e) {\r\n\t\tPointInfo middle = new PointInfo((left.getInput()+right.getInput())/2, e);\r\n\t\tdouble dLeft = (middle.getOutput()-left.getOutput())/(middle.getInput()-left.getInput());\r\n\t\tdouble aLeft = Math.atan(dLeft);\r\n\t\tdouble dRight = (right.getOutput()-middle.getOutput())/(right.getInput()-middle.getInput());\r\n\t\tdouble aRight = Math.atan(dRight);\r\n\t\tdouble angleInDegree = (Math.abs(aLeft-aRight))*180/Math.PI;\r\n\t\tif(angleInDegree<GraphImage_Params.angleThreshold||currentRecursion==GraphImage_Params.maxRecursion) {\r\n\t\t\t//System.out.printf(\"left: %f, right: %f, angle: %f\\n\",dLeft,dRight,angleInDegree);\r\n\t\t\tif(left.getState().equals(PointState.Inside)&&middle.getState().equals(PointState.Inside)\r\n\t\t\t\t\t || (left.getState().equals(PointState.Outside)&&middle.getState().equals(PointState.Inside))\r\n\t\t\t\t\t || (left.getState().equals(PointState.Inside)&&middle.getState().equals(PointState.Outside))) \r\n\t\t\t{\r\n\t\t\t\tgc.strokeLine(left.getOnScreenX(), left.getOnScreenY(), middle.getOnScreenX(), middle.getOnScreenY());\r\n\t\t\t}else {\r\n\t\t\t\t//System.out.println(\"hello\");\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn middle;\r\n\t\t\t\r\n\t\t}else {\r\n\t\t\tgc.setStroke(Color.rgb(230, 33, 0));\r\n\t\t\tif(currentRecursion==0) {\r\n\t\t\t\tgc.setStroke(Color.GREEN);\r\n\t\t\t}\r\n\t\t\telse if(currentRecursion==1) {\r\n\t\t\t\tgc.setStroke(Color.BLUE);\r\n\t\t\t}\r\n\t\t\telse if(currentRecursion==2) {\r\n\t\t\t\tgc.setStroke(Color.ORANGE);\r\n\t\t\t}\r\n\t\t\telse if(currentRecursion==3) {\r\n\t\t\t\tgc.setStroke(Color.RED);\r\n\t\t\t}\r\n\r\n\t\t\tdouble xMiddleLeft = (left.getInput()+middle.getInput())/2;\r\n\t\t\tdouble xMiddleRight = (right.getInput()+middle.getInput())/2;\r\n\t\t\tPointInfo pMiddleLeft = new PointInfo(xMiddleLeft, e);\r\n\t\t\tPointInfo pMiddleRight = new PointInfo(xMiddleRight, e);\r\n\t\t\t\r\n\t\t\tpMiddleLeft = inspectFurther(left, middle,currentRecursion+1,e);\r\n\t\t\tmiddle = inspectFurther(pMiddleLeft, pMiddleRight,currentRecursion+1,e);\r\n\t\t\tpMiddleRight = inspectFurther(middle, right,currentRecursion+1,e);\r\n\t\t\t\r\n\t\t\treturn pMiddleRight;\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate void approximateUndeterminedPoint(PointInfo nearPoint, PointInfo underterminedPoint, Expression e) {\r\n\t\tif(nearPoint.getInput()>underterminedPoint.getInput()) {\r\n\t\t\tapproximateUndeterminedPointLeft(nearPoint, underterminedPoint, e);\r\n\t\t}else {\r\n\t\t\tapproximateUndeterminedPointRight(nearPoint, underterminedPoint, e);\r\n\t\t}\r\n\t}\r\n\tprivate void approximateUndeterminedPointLeft(PointInfo nearPoint, PointInfo underterminedPoint, Expression e) {\r\n\t\tdouble left = underterminedPoint.getInput(), right = nearPoint.getInput();\r\n\t\tdouble currentApproximation = (left+right)/2;\r\n\t\tPointInfo prePointInfo = nearPoint;\r\n\t\tfor(int i = 0;i<GraphImage_Params.loopLimit;i++) {\r\n\t\t\tPointInfo curPointInfo = new PointInfo(currentApproximation, e);\r\n\t\t\tPointState state = curPointInfo.getState();\r\n\t\t\tif(state.equals(PointState.Inside)) {\r\n\t\t\t\tright = currentApproximation;\r\n\t\t\t\tcurrentApproximation = (left+right)/2;\t\r\n\t\t\t\tgc.strokeLine(prePointInfo.getOnScreenX(), prePointInfo.getOnScreenY(), \r\n\t\t\t\t\t\tcurPointInfo.getOnScreenX(), curPointInfo.getOnScreenY());\r\n\t\t\t}\r\n\t\t\telse if(state.equals(PointState.Undetermined)) {\r\n\t\t\t\tleft = currentApproximation;\r\n\t\t\t\tcurrentApproximation = (left+right)/2;\t\t\t\t\r\n\t\t\t}\r\n\t\t\telse if(state.equals(PointState.MinusInfinity)) {\r\n\t\t\t\tgc.strokeLine(prePointInfo.getOnScreenX(), prePointInfo.getOnScreenY(), \r\n\t\t\t\t\t\tprePointInfo.getOnScreenX(), canvas.getHeight());\t\t\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telse if(state.equals(PointState.MinusInfinity)) {\r\n\t\t\t\tgc.strokeLine(prePointInfo.getOnScreenX(), prePointInfo.getOnScreenY(), \r\n\t\t\t\t\t\tprePointInfo.getOnScreenX(), 0);\t\t\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t//System.out.printf(\"Left: %.20f, Right: %.20f, Middle: %.20f\\n\", left,right,currentApproximation);\r\n\t\t}\r\n\t\t//System.out.println(\"\\n\\n\");\r\n\t}\r\n\tprivate void approximateUndeterminedPointRight(PointInfo nearPoint, PointInfo underterminedPoint, Expression e) {\r\n\t\tapproximateUndeterminedPointLeft(nearPoint, underterminedPoint, e);\r\n\t}\r\n\t\r\n\tprivate double getOnCanvasCoordinateX(double point) {\r\n\t\tdouble dstX = point - settingRef.leftBoundary.get();\r\n\t\tdouble ratio = dstX/settingRef.getBoundaryWidth();\r\n\t\tdouble onScreen = ratio*canvas.getWidth();\r\n\t\treturn onScreen;\r\n\t}\r\n\tprivate double getOnCanvasCoordinateY(double point) {\r\n\t\tdouble dstY = settingRef.topBoundary.get() - point;\r\n\t\tdouble ratio = dstY/settingRef.getBoundaryHeight();\r\n\t\tdouble onScreen = ratio*canvas.getHeight();\r\n\t\treturn onScreen;\r\n\t}\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/main/doanjava2/graphCanvas/GraphImage.java b/src/main/java/main/doanjava2/graphCanvas/GraphImage.java
--- a/src/main/java/main/doanjava2/graphCanvas/GraphImage.java	
+++ b/src/main/java/main/doanjava2/graphCanvas/GraphImage.java	
@@ -124,7 +124,7 @@
 			this.input = input;
 		}
 	}
-	private void drawGraph() {
+		private void drawGraph() {
 		if(dataRef.getExpressionString().equals("")) {
 			return;
 		}
